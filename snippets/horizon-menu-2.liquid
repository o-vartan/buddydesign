<!-- Horizon menu for Header v2 -->

{% assign main_menu = section.settings.menu_ver3%}

<ul class="nav navbar-nav js-menubar">
  {% for link in linklists[main_menu].links %} 
  {% assign item = link.title | downcase %}
  {% assign child_list_handle = link.title | handleize %}
  
  {% capture megamenu_1 %}megamenu2_1_parent{% endcapture %}
  {% capture megamenu_2 %}megamenu2_2_parent{% endcapture %}
  
  {% if settings[megamenu_1] == item or settings[megamenu_2] == item %}
    {% for i in (1..2) %}
    {%capture megamenu%}megamenu2_{{i}}_parent{%endcapture%}

    {% if settings[megamenu] == item %}
    {% capture _mega_style_select %}megamenu2_{{i}}_select{% endcapture %}
    {% if settings[_mega_style_select] == "m_s2" %}
    <li class="level1 dropdown hassub">
      {% if link.title contains '[' %}
      {%- assign label  = link.title | split: '[' | last  | split: ']' | first -%}  
      {%- assign bgc  = link.title | split: '(' | last  | split: ')' | first -%}
      <a href="{{ link.url }}">{{link.title | split: '[' | first }}<span class="h-ribbon h-pos {%if section.settings.select_hds == "header_v2" or section.settings.select_hds_all == "header_ver2" %}v4{%endif%} {% if link.title contains '('%} e-{{bgc}} {%else%} e-skyblue {%endif%}">{{label}}</span></a>
      {%else%}
      <a href="{{ link.url }}">{{link.title | split: '[' | first }}</a>
      {%endif%}
      <div class="menu-level-1 dropdown-menu">
        <ul class="level1">	
          {% for j in (1..3) %}
          <li class="level2 col-4">
            {% capture mega_title %}megamenu2_{{ i }}_column_{{ j }}_title_1{% endcapture %}
            {% capture mega_col %}megamenu2_{{ i }}_column_{{ j }}_menu_1{% endcapture %}
            {% if forloop.index == 2 %}
            <a>{{ settings[mega_title] }}</a>
            <ul class="menu-level-2">
              {% for link in linklists[settings[mega_col]].links %}
              <li class="level3">{% if link.title contains '[' %}
                {%- assign label  = link.title | split: '[' | last  | split: ']' | first -%}  
                {%- assign bgc  = link.title | split: '(' | last  | split: ')' | first -%}                    
                <a href="{{ link.url }}" title="{{link.title | split: '[' | first }}">{{link.title | split: '[' | first }}<span class="h-ribbon h-pos v3 {% if link.title contains '('%} e-{{bgc}} {%else%} e-red {%endif%}">{{label}}</span></a>
                {%else%}
                <a href="{{ link.url }}" title="{{link.title | split: '[' | first }}">{{link.title | split: '[' | first }}</a>
                {%endif%}</li>
              {% endfor %}
            </ul>
            {% else %}
            {% for k in (1..2) %}
            {% capture mega_title %}megamenu2_{{ i }}_column_{{ j }}_title_{{k}}{% endcapture %}
            {% capture mega_col %}megamenu2_{{ i }}_column_{{ j }}_menu_{{k}}{% endcapture %}
            {% capture mega_image %}megamenu2_{{ i }}_column_{{ j }}_image.jpg{% endcapture %}
            {% capture mega_image_url %}megamenu2_{{ i }}_column_{{ j }}_image_url{% endcapture %}
            <a>{{ settings[mega_title] }}</a>
            <ul class="menu-level-2">
              {% for link in linklists[settings[mega_col]].links %}
              <li class="level3">{% if link.title contains '[' %}
                {%- assign label  = link.title | split: '[' | last  | split: ']' | first -%}  
                {%- assign bgc  = link.title | split: '(' | last  | split: ')' | first -%}                        
                <a href="{{ link.url }}" title="{{link.title | split: '[' | first }}">{{link.title | split: '[' | first }}<span class="h-ribbon h-pos v3 {% if link.title contains '('%} e-{{bgc}} {%else%} e-red {%endif%}">{{label}}</span></a>
                {%else%}
                <a href="{{ link.url }}" title="{{link.title | split: '[' | first }}">{{link.title | split: '[' | first }}</a>
                {%endif%}</li>
              {% endfor %}
            </ul>
            {% endfor %}
            {% endif %}

            {% endfor %}
          </li>


        </ul>
        <div class="clearfix"></div>
      </div>
    </li>
    {% else %}
    <li class="level1 active hassub">
      <a href="{{ link.url }}">{{ link.title }}</a>
      <div class="menu-level-1 ver2 dropdown-menu">
        <div class="row">
          {% for j in (1..5) %}

          <div class="cate-item col-md-4 col-sm-12">

            {% capture mega_title %}megamenu2_{{ i }}_column_{{ j }}_title{% endcapture %}
            {% capture mega_col %}megamenu2_{{ i }}_column_{{ j }}_menu{% endcapture %}
            {% capture mega_image %}megamenu2_{{ i }}_column_{{ j }}_image.jpg{% endcapture %}
            {% capture mega_image_url %}megamenu2_{{ i }}_column_{{ j }}_image_url{% endcapture %}
            <div class="demo-img">


              <a href="{{ settings[mega_image_url] }}">
                <img src="{{ mega_image | asset_url }}" alt="" class="img-reponsive">
              </a>


            </div>
            <div class="demo-text">{{ settings[mega_title] }}</div>

          </div>

          {% endfor %}
        </div>
      </div>
    </li>	
    {%endif%}

    {%endif%}
    {% endfor %}
  
  {% else %}
  
    {% if linklists[child_list_handle].links != blank %}
    <li class="level1 active dropdown">
      {% if link.title contains '[' %}
      {%- assign label  = link.title | split: '[' | last  | split: ']' | first -%}  
      {%- assign bgc  = link.title | split: '(' | last  | split: ')' | first -%}
      <a href="{{ link.url }}" title="{{link.title | split: '[' | first }}">{{link.title | split: '[' | first }}<span class="h-ribbon h-pos {%if section.settings.select_hds == "header_v2" or section.settings.select_hds_all == "header_ver2" %}v4{%endif%} {% if link.title contains '('%} e-{{bgc}} {%else%} e-skyblue {%endif%}">{{label}}</span></a>
      {%else%}
      <a href="{{ link.url }}" title="{{link.title | split: '[' | first }}">{{link.title | split: '[' | first }}</a>
      {%endif%}
      <ul class="dropdown-menu menu-level-1">
        {% for childlink in linklists[child_list_handle].links %}
        <li{% if childlink.active %} class="level2"{% endif %}>
          <a href="{{ childlink.url }}" title="{{link.title | split: '[' | first }}" class="">{{ childlink.title | escape }}</a>
        </li>
        {% endfor %}
      </ul>
    </li>
    {% else %} 
    <li class="level1 active" {% if link.active %}class="dropdown"{% endif %}>
      {% if link.title contains '[' %}
      {%- assign label  = link.title | split: '[' | last  | split: ']' | first -%} 
      {%- assign bgc  = link.title | split: '(' | last  | split: ')' | first -%}
      <a href="{{ link.url }}" title="{{link.title | split: '[' | first }}">{{link.title | split: '[' | first }}<span class="h-ribbon h-pos {%if section.settings.select_hds == "header_v2" or section.settings.select_hds_all == "header_ver2" %}v4{%endif%} {% if link.title contains '('%} e-{{bgc}} {%else%} e-skyblue {%endif%}">{{label}}</span></a>
      {%else%}
      <a href="{{ link.url }}" title="{{link.title | split: '[' | first }}">{{link.title | split: '[' | first }}</a>
      {% endif %}
    </li>
    {% endif %}
  
  {% endif %}
  {% endfor %}
</ul>