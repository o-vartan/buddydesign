<ul class="nav navbar-nav menu-main">
  {% assign main_menu_2 = section.settings.menu_ver2 %}
  {% for link in linklists[main_menu_2].links %}
  {% assign item = link.title | downcase %}
  {% assign child_list_handle = link.title | handleize %}
  
  {% capture megamenu_1 %}megamenu2_1_parent{% endcapture %}
  {% capture megamenu_2 %}megamenu2_2_parent{% endcapture %}
  {% capture megamenu_3 %}megamenu2_3_parent{% endcapture %}
  {% capture megamenu_4 %}megamenu2_4_parent{% endcapture %}
  
  {% if settings[megamenu_1] == item or settings[megamenu_2] == item or settings[megamenu_3] == item or settings[megamenu_4] == item %}
    {% for i in (1..4) %}
    {%capture megamenu%}megamenu2_{{i}}_parent{%endcapture%}
    {%capture _mega_limit%}megamenu2_{{i}}_s4_max_collection{%endcapture%}
    {% if settings[megamenu] == item %}
    {% capture _mega_style_select %}megamenu2_{{i}}_select{% endcapture %}
    {% if settings[_mega_style_select] == "m_s1" %}
    <li class="relative dropdown">
      {% if link.title contains '[' %}
      {%- assign label  = link.title | split: '[' | last  | split: ']' | first -%}  
      {%- assign bgc  = link.title | split: '(' | last  | split: ')' | first -%}
      <a href="{{ link.url }}" title="{{link.title | split: '[' | first }}" class="delay03 ">{{link.title | split: '[' | first }}
        <span class="absolute label_menu {% if link.title contains '('%} e-{{bgc}} {%else%} e-red {%endif%}">{{label}}</span>
      </a>
      {%else%}
      <a href="{{ link.url }}" title="{{link.title | split: '[' | first }}" class="delay03 ">{{link.title | split: '[' | first }}</a>
      {%endif%}
      <div class="dropdown-menu mega-menu-main absolute space_30 space_top_bot_50 text-left mega-menu-shop bg-mega-menu1">
        <div class="relative row">
          {% for k in (1..8) %} 
          {% capture mega_title %}megamenu2_{{ i }}_column_{{ k }}_title{% endcapture %}
          {% capture mega_col %}megamenu2_{{ i }}_column_{{ k }}_menu{% endcapture %}
          {% capture mega_image %}img-{{ i }}-home{{k}}{% endcapture %}

          <div class="column-4 hover-filter container_15 left">
            {% for link in linklists[settings[mega_col]].links %}
            <a class="delay03 relative" href="{{ link.url }}">
              <img src="{% if settings[mega_image] == blank %}{{'home_1_menu-min.png' | asset_url }}{% else %}{{settings[mega_image] | img_url:'master'}}{% endif %}" alt="" class="img-responsive box-shadow">
            </a>
            <p><a href="{{ link.url }}" class="delay03 uppercase  clear-space animate inline-block lt-2">{{ link.title }}</a></p>
            {% endfor %}
          </div>

          {% endfor %}
        </div>
      </div>
    </li>
    {% elsif settings[_mega_style_select] == "m_s2" %}
    <li class="relative dropdown">
      {% if link.title contains '[' %}
      {%- assign label  = link.title | split: '[' | last  | split: ']' | first -%}  
      {%- assign bgc  = link.title | split: '(' | last  | split: ')' | first -%}
      <a href="{{ link.url }}" title="{{link.title | split: '[' | first }}" class="delay03">{{link.title | split: '[' | first }}
        <span class="absolute label_menu {% if link.title contains '('%} e-{{bgc}} {%else%} e-red {%endif%}">{{label}}</span>
      </a>
      {%else%}
      <a href="{{ link.url }}" title="{{link.title | split: '[' | first }}" class="delay03">{{link.title | split: '[' | first }}</a>
      {%endif%}

      <div class="dropdown-menu mega-menu-main absolute space_30 space_top_bot_50 text-left mega-menu-shop bg-mega-menu2">
        <div class="container_15">
          <div class="row">
            {% for k in (1..4) %} 
            {% capture mega_title_shop %}megamenu2_{{ i }}_column_{{ k }}_title{% endcapture %}
            {% capture mega_col_shop %}megamenu2_{{ i }}_column_{{ k }}_menu{% endcapture %}
            <div class="col-lg-3 col-md-3">
              <ul class="{% if forloop.first == true %}clear-space{% endif %} capital lv1">
                <li class="margin_bottom_20 uppercase relative title-menu lt-2">{{ settings[mega_title_shop] }}
                </li>
                {% for link in linklists[settings[mega_col_shop]].links %}
                <li class="menu-child-font">
                  {% if link.title contains '[' %}
                  {%- assign label  = link.title | split: '[' | last  | split: ']' | first -%}  
                  {%- assign bgc  = link.title | split: '(' | last  | split: ')' | first -%}
                  <a href="{{ link.url }}" title="{{link.title | split: '[' | first }}" class="delay03 relative">{{link.title | split: '[' | first }}
                    <span class="absolute label_menu {% if link.title contains '('%} e-{{bgc}} {%else%} e-red {%endif%}">{{label}}</span>
                  </a>
                  {%else%}
                  <a href="{{ link.url }}" title="{{link.title | split: '[' | first }}" class="delay03">{{link.title | split: '[' | first }}</a>
                  {%endif%}
                </li>
                {% endfor %}
              </ul>
            </div>
            {% endfor %}

          </div>
        </div>
      </div>
    </li>
    {% elsif settings[_mega_style_select] == "m_s3" %}
    <li class="relative dropdown">
      {% if link.title contains '[' %}
      {%- assign label  = link.title | split: '[' | last  | split: ']' | first -%}  
      {%- assign bgc  = link.title | split: '(' | last  | split: ')' | first -%}
      <a href="{{ link.url }}" title="{{link.title | split: '[' | first }}" class="delay03 ">{{link.title | split: '[' | first }}
        <span class="absolute label_menu {% if link.title contains '('%} e-{{bgc}} {%else%} e-red {%endif%}">{{label}}</span>
      </a>
      {%else%}
      <a href="{{ link.url }}" title="{{link.title | split: '[' | first }}" class="delay03 ">{{link.title | split: '[' | first }}</a>
      {%endif%}

      <div class="dropdown-menu mega-menu-main absolute space_30 space_top_bot_50 text-left mega-menu-shop-2column bg-mega-menu3">
        <div class="container_15">
          <div class="row">
            {% for k in (1..3) %} 
            {% capture mega_title_shop %}megamenu2_{{ i }}_column_{{ k }}_title{% endcapture %}
            {% capture mega_col_shop %}megamenu2_{{ i }}_column_{{ k }}_menu{% endcapture %}
            <div class="col-lg-4 col-md-4">
              <ul class="{% if forloop.first == true %}clear-space{% else %}space_left_30{% endif %} capital lv1">

                <li class="margin_bottom_20 uppercase title-menu lt-2 relative">{{ settings[mega_title_shop] }}
                </li>
                {% for link in linklists[settings[mega_col_shop]].links %}
                <li class="menu-child-font">
                  {% if link.title contains '[' %}
                  {%- assign label  = link.title | split: '[' | last  | split: ']' | first -%}  
                  {%- assign bgc  = link.title | split: '(' | last  | split: ')' | first -%}
                  <a href="{{ link.url }}" title="{{link.title | split: '[' | first }}" class="delay03  relative">{{link.title | split: '[' | first }}
                    <span class="absolute label_menu {% if link.title contains '('%} e-{{bgc}} {%else%} e-red {%endif%}">{{label}}</span>
                  </a>
                  {%else%}
                  <a href="{{ link.url }}" title="{{link.title | split: '[' | first }}" class="delay03 ">{{link.title | split: '[' | first }}</a>
                  {%endif%}
                </li>
                {% endfor %}
              </ul>
            </div>
            {% endfor %}

          </div>
        </div>
      </div>
    </li>
    {% elsif settings[_mega_style_select] == "m_s4" %}

    <li class="relative dropdown">
      <a href="{{ link.url }}" title="{{link.title}}">{{link.title}}
        {% capture _menu_label %}
        {%  if _sale_handles contains link.handle %}{{_sale_menu_html}}{% endif %}
        {%  if _new_handles contains link.handle %}{{_new_menu_html}}{% endif %}
        {%  if _deal_handles contains link.handle %}{{_deal_menu_html}}{% endif %}
        {%  if _hot_handles contains link.handle %}{{_hot_menu_html}}{% endif %}
        {% endcapture %}

        {% if _menu_label != blank %}{{_menu_label}}{% endif %}
      </a>
      <div class="dropdown-menu mega-menu-main absolute space_30 space_top_bot_50 text-left mega-menu-shop bg-mega-menu4">
        <div class="row">
          {% for collection in collections limit:settings[_mega_limit]%}
          {% include 'menu-collection-grid-item'%}
          {% endfor %}
        </div>

      </div>
    </li>
    {% endif %}
    {% endif %}
    {% endfor %}
  
  {% else %}
  
    {% if linklists[child_list_handle].links != blank %}
    <li class="relative dropdown">
      {% if link.title contains '[' %}
      {%- assign label  = link.title | split: '[' | last  | split: ']' | first -%}  
      {%- assign bgc  = link.title | split: '(' | last  | split: ')' | first -%}
      <a href="{{ link.url }}" title="{{link.title | split: '[' | first }}" class="delay03 ">{{link.title | split: '[' | first }}
        <span class="absolute label_menu {% if link.title contains '('%} e-{{bgc}} {%else%} e-red {%endif%}">{{label}}</span>
      </a>
      {%else%}
      <a href="{{ link.url }}" title="{{link.title | split: '[' | first }}" class="delay03 ">{{link.title | split: '[' | first }}</a>
      {%endif%}
      {% if link.links != blank %}
      <ul class="dropdown-menu">
        {% for child_link in link.links %}
        <li>
          <a class="delay03 capital" href="{{child_link.url}}">{{ child_link.title | escape }}</a>
        </li>
        {% endfor %}
      </ul>
      {% endif %}
    </li>
    {% else %}
    <li class="relative">
      {% if link.title contains '[' %}
      {%- assign label  = link.title | split: '[' | last  | split: ']' | first -%}  
      {%- assign bgc  = link.title | split: '(' | last  | split: ')' | first -%}
      <a href="{{ link.url }}" title="{{link.title | split: '[' | first }}" class="delay03 uppercase">{{link.title | split: '[' | first }}
        <span class="absolute label_menu {% if link.title contains '('%} e-{{bgc}} {%else%} e-red {%endif%}">{{label}}</span>
      </a>
      {% elsif link.title contains '<' %}
      <a href="{{ shop.url }}" title="{{shop.name}}">
        {% if settings.hdv1_logo == blank %}
        <img alt="{{shop.name}}" src="{{'logo.png' | asset_url}}" class="img-logo">
        {% else %}
        <img alt="{{shop.name}}" src="{{settings.hdv1_logo | img_url:'master'}}" class="img-logo">
        {% endif %}
      </a>
      {%else%}
      <a href="{{ link.url }}" title="{{link.title | split: '[' | first }}" class="delay03 uppercase">{{link.title | split: '[' | first }}</a>
      {%endif%}
    </li>
    {% endif %}
  
  {% endif %}
  {% endfor %}
</ul>